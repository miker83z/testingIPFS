{"version":3,"file":"module.js","sources":["../src/JsonStreamStringify.js"],"sourcesContent":["import { Readable } from 'stream';\n\nconst rxEscapable = /[\\\\\"\\u0000-\\u001f\\u007f-\\u009f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g;\n\n// table of character substitutions\nconst meta = {\n  '\\b': '\\\\b',\n  '\\t': '\\\\t',\n  '\\n': '\\\\n',\n  '\\f': '\\\\f',\n  '\\r': '\\\\r',\n  '\"': '\\\\\"',\n  '\\\\': '\\\\\\\\',\n};\n\nfunction isReadableStream(value) {\n  return typeof value.read === 'function'\n        && typeof value.once === 'function'\n        && typeof value.removeListener === 'function'\n        && typeof value._readableState === 'object';\n}\n\nfunction getType(value) {\n  if (!value) return 'Primitive';\n  if (typeof value.then === 'function') return 'Promise';\n  if (isReadableStream(value)) return `Readable${value._readableState.objectMode ? 'Object' : 'String'}`;\n  if (Array.isArray(value)) return 'Array';\n  if (typeof value === 'object' || value instanceof Object) return 'Object';\n  return 'Primitive';\n}\n\nconst stackItemEnd = {\n  Array: ']',\n  Object: '}',\n  ReadableString: '\"',\n  ReadableObject: ']',\n};\n\nconst stackItemOpen = {\n  Array: '[',\n  Object: '{',\n  ReadableString: '\"',\n  ReadableObject: '[',\n};\n\nfunction escapeString(string) {\n  // Modified code, original code by Douglas Crockford\n  // Original: https://github.com/douglascrockford/JSON-js/blob/master/json2.js\n\n  // If the string contains no control characters, no quote characters, and no\n  // backslash characters, then we can safely slap some quotes around it.\n  // Otherwise we must also replace the offending characters with safe escape\n  // sequences.\n\n  return string.replace(rxEscapable, (a) => {\n    const c = meta[a];\n    return typeof c === 'string' ? c : `\\\\u${a.charCodeAt(0).toString(16).padStart(4, '0')}`;\n  });\n}\n\nfunction quoteString(string) {\n  return `\"${escapeString(string)}\"`;\n}\n\nfunction readAsPromised(stream, size) {\n  const value = stream.read(size);\n  if (value === null) {\n    return new Promise((resolve, reject) => {\n      const endListener = () => resolve(null);\n      stream.once('end', endListener);\n      stream.once('error', reject);\n      stream.once('readable', () => {\n        stream.removeListener('end', endListener);\n        stream.removeListener('error', reject);\n        resolve(stream.read());\n      });\n    });\n  }\n  return Promise.resolve(value);\n}\n\nfunction recursiveResolve(promise) {\n  return promise.then((res) => {\n    const resType = getType(res);\n    return resType === 'Promise' ? recursiveResolve(res) : res;\n  });\n}\n\nclass JsonStreamStringify extends Readable {\n  constructor(value, replacer, spaces, cycle) {\n    super({});\n    let gap;\n    const spaceType = typeof spaces;\n    if (spaceType === 'string' || spaceType === 'number') {\n      gap = Number.isFinite(spaces) ? ' '.repeat(spaces) : spaces;\n    }\n    Object.assign(this, {\n      visited: cycle ? new WeakMap() : new WeakSet(),\n      cycle,\n      stack: [],\n      replacerFunction: replacer instanceof Function && replacer,\n      replacerArray: Array.isArray(replacer) && replacer,\n      gap,\n      depth: 0,\n    });\n    this.addToStack(value);\n  }\n\n  cycler(key, value) {\n    const existingPath = this.visited.get(value);\n    if (existingPath) {\n      return {\n        $ref: existingPath,\n      };\n    }\n    let path = this.path();\n    if (key !== undefined) path.push(key);\n    path = path.map(v => `[${(Number.isInteger(v) ? v : quoteString(v))}]`);\n    this.visited.set(value, path.length ? `$${path.join('')}` : '$');\n    return value;\n  }\n\n  addToStack(value, key, index, parent) {\n    let realValue = value;\n    if (this.replacerFunction) {\n      realValue = this.replacerFunction(key || index, realValue, this);\n    }\n    // ORDER?\n    if (realValue && realValue.toJSON instanceof Function) {\n      realValue = realValue.toJSON();\n    }\n    if (realValue instanceof Function || typeof value === 'symbol') {\n      realValue = undefined;\n    }\n    if (key !== undefined && this.replacerArray) {\n      if (!this.replacerArray.includes(key)) {\n        realValue = undefined;\n      }\n    }\n    let type = getType(realValue);\n    if (((parent && parent.type === 'Array') ? true : realValue !== undefined) && type !== 'Promise') {\n      if (parent && !parent.first) {\n        this._push(',');\n      }\n      /* eslint-disable-next-line no-param-reassign */\n      if (parent) parent.first = false;\n    }\n    if (realValue !== undefined && type !== 'Promise' && key) {\n      if (this.gap) {\n        this._push(`\\n${this.gap.repeat(this.depth)}\"${escapeString(key)}\": `);\n      } else {\n        this._push(`\"${escapeString(key)}\":`);\n      }\n    }\n    if (type !== 'Primitive') {\n      if (this.cycle) {\n        // run cycler\n        realValue = this.cycler(key || index, realValue);\n        type = getType(realValue);\n      } else {\n        // check for circular structure\n        if (this.visited.has(realValue)) {\n          throw Object.assign(new Error('Converting circular structure to JSON'), {\n            realValue,\n            key: key || index,\n          });\n        }\n        this.visited.add(realValue);\n      }\n    }\n\n    if (!key && index > -1 && this.depth && this.gap) this._push(`\\n${this.gap.repeat(this.depth)}`);\n\n    const open = stackItemOpen[type];\n    if (open) this._push(open);\n\n    const obj = {\n      key,\n      index,\n      type,\n      value: realValue,\n      parent,\n      first: true,\n    };\n\n    if (type === 'Object') {\n      this.depth += 1;\n      obj.unread = Object.keys(realValue);\n      obj.isEmpty = !obj.unread.length;\n    } else if (type === 'Array') {\n      this.depth += 1;\n      obj.unread = realValue.length;\n      obj.arrayLength = obj.unread;\n      obj.isEmpty = !obj.unread;\n    } else if (type.startsWith('Readable')) {\n      this.depth += 1;\n      if (realValue._readableState.ended) {\n        this.emit('error', new Error('Readable Stream has ended before it was serialized. All stream data have been lost'), realValue, key || index);\n      } else if (realValue._readableState.flowing) {\n        realValue.pause();\n        this.emit('error', new Error('Readable Stream is in flowing mode, data may have been lost. Trying to pause stream.'), realValue, key || index);\n      }\n      obj.readCount = 0;\n      realValue.once('end', () => {\n        obj.end = true;\n        this.__read();\n      });\n      realValue.once('error', (err) => {\n        this.error = true;\n        this.emit('error', err);\n      });\n    }\n    this.stack.unshift(obj);\n    return obj;\n  }\n\n  removeFromStack(item) {\n    const {\n      type,\n    } = item;\n    const isObject = type === 'Object' || type === 'Array' || type.startsWith('Readable');\n    if (type !== 'Primitive') {\n      if (!this.cycle) {\n        this.visited.delete(item.value);\n      }\n      if (isObject) {\n        this.depth -= 1;\n      }\n    }\n\n    const end = stackItemEnd[type];\n    if (isObject && !item.isEmpty && this.gap) this._push(`\\n${this.gap.repeat(this.depth)}`);\n    if (end) this._push(end);\n    const stackIndex = this.stack.indexOf(item);\n    this.stack.splice(stackIndex, 1);\n  }\n\n  _push(data) {\n    this.pushCalled = true;\n    this.push(data);\n  }\n\n  processReadableObject(current, size) {\n    if (current.end) {\n      this.removeFromStack(current);\n      return undefined;\n    }\n    return readAsPromised(current.value, size)\n      .then((value) => {\n        if (value !== null) {\n          if (!current.first) {\n            this._push(',');\n          }\n          /* eslint-disable no-param-reassign */\n          current.first = false;\n          this.addToStack(value, undefined, current.readCount);\n          current.readCount += 1;\n          /* eslint-enable no-param-reassign */\n        }\n      });\n  }\n\n  processObject(current) {\n    // when no keys left, remove obj from stack\n    if (!current.unread.length) {\n      this.removeFromStack(current);\n      return;\n    }\n    const key = current.unread.shift();\n    const value = current.value[key];\n    this.addToStack(value, key, undefined, current);\n  }\n\n  processArray(current) {\n    const key = current.unread;\n    if (!key) {\n      this.removeFromStack(current);\n      return;\n    }\n    const index = current.arrayLength - key;\n    const value = current.value[index];\n    /* eslint-disable-next-line no-param-reassign */\n    current.unread -= 1;\n    this.addToStack(value, undefined, index, current);\n  }\n\n  processPrimitive(current) {\n    if (current.value !== undefined) {\n      const type = typeof current.value;\n      let value;\n      switch (type) {\n      case 'string':\n        value = quoteString(current.value);\n        break;\n      case 'number':\n        value = Number.isFinite(current.value) ? String(current.value) : 'null';\n        break;\n      case 'boolean':\n      case 'null':\n        value = String(current.value);\n        break;\n      case 'object':\n        if (!current.value) {\n          value = 'null';\n          break;\n        }\n        /* eslint-disable-next-line no-fallthrough */\n      default:\n        // This should never happen, I can't imagine a situation where this executes.\n        // If you find a way, please open a ticket or PR\n        throw Object.assign(new Error(`Unknown type \"${type}\". Please file an issue!`), {\n          value: current.value,\n        });\n      }\n      this._push(value);\n    } else if (this.stack[1] && (this.stack[1].type === 'Array' || this.stack[1].type === 'ReadableObject')) {\n      this._push('null');\n    } else {\n      /* eslint-disable-next-line no-param-reassign */\n      current.addSeparatorAfterEnd = false;\n    }\n    this.removeFromStack(current);\n  }\n\n  processReadableString(current, size) {\n    if (current.end) {\n      this.removeFromStack(current);\n      return undefined;\n    }\n    return readAsPromised(current.value, size)\n      .then((value) => {\n        if (value) this._push(escapeString(value.toString()));\n      });\n  }\n\n  processPromise(current) {\n    return recursiveResolve(current.value).then((value) => {\n      this.removeFromStack(current);\n      this.addToStack(value, current.key, current.index, current.parent);\n    });\n  }\n\n  processStackTopItem(size) {\n    const current = this.stack[0];\n    if (!current || this.error) return Promise.resolve();\n    let out;\n    try {\n      out = this[`process${current.type}`](current, size);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n    return Promise.resolve(out)\n      .then(() => {\n        if (this.stack.length === 0) {\n          this.end = true;\n          this._push(null);\n        }\n      });\n  }\n\n  __read(size) {\n    if (this.isRunning || this.error) {\n      this.readMore = true;\n      return undefined;\n    }\n    this.isRunning = true;\n\n    // we must continue to read while push has not been called\n    this.readMore = false;\n    return this.processStackTopItem(size)\n      .then(() => {\n        const readAgain = !this.end && !this.error && (this.readMore || !this.pushCalled);\n        if (readAgain) {\n          setImmediate(() => {\n            this.isRunning = false;\n            this.__read();\n          });\n        } else {\n          this.isRunning = false;\n        }\n      })\n      .catch((err) => {\n        this.error = true;\n        this.emit('error', err);\n      });\n  }\n\n  _read(size) {\n    this.pushCalled = false;\n    this.__read(size);\n  }\n\n  path() {\n    return this.stack.map(({\n      key,\n      index,\n    }) => key || index).filter(v => v || v > -1).reverse();\n  }\n}\n\nexport default JsonStreamStringify;\n"],"names":["rxEscapable","meta","isReadableStream","value","read","once","removeListener","_readableState","getType","then","objectMode","Array","isArray","Object","stackItemEnd","stackItemOpen","escapeString","string","replace","a","c","charCodeAt","toString","padStart","quoteString","readAsPromised","stream","size","Promise","resolve","reject","endListener","recursiveResolve","promise","res","resType","JsonStreamStringify","replacer","spaces","cycle","gap","spaceType","Number","isFinite","repeat","assign","WeakMap","WeakSet","Function","addToStack","key","existingPath","visited","get","path","undefined","push","map","isInteger","v","set","length","join","index","parent","realValue","replacerFunction","toJSON","replacerArray","includes","type","first","_push","depth","cycler","has","Error","add","open","obj","unread","keys","isEmpty","arrayLength","startsWith","ended","emit","flowing","pause","readCount","end","__read","err","error","stack","unshift","item","isObject","delete","stackIndex","indexOf","splice","data","pushCalled","current","removeFromStack","shift","String","addSeparatorAfterEnd","out","isRunning","readMore","processStackTopItem","readAgain","catch","filter","reverse","Readable"],"mappings":"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"}